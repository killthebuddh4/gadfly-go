def record.equal
  fn |a b|
    def result true end

    def test
      fn |key i|
        def a_val
          read a key end
        end
        
        def b_val
          read b key end
        end

        if result == true
          if a_val != b_val
            let result false end
            nil
          end
          nil
        end
      end
    end

    for
      keys a end
      test
    end

    for
      keys b end
      test
    end
      
    result
  end
end